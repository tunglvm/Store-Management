(()=>{var e={};e.id=416,e.ids=[416],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9626:(e,s,r)=>{Promise.resolve().then(r.bind(r,78627))},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},39461:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>v});var t=r(60687),a=r(43210),n=r(16189),i=r(24934),d=r(55192),l=r(59821),o=r(57769),c=r(28559),m=r(93613),x=r(51563),h=r(5336),u=r(48730),p=r(31158),g=r(52581),j=r(9577),f=r(24302),N=r(59556);function v(){let{isCollapsed:e}=(0,f.c)(),s=(0,n.useParams)(),r=(0,n.useRouter)(),v=s.orderId,[w,b]=(0,a.useState)(null),[y,k]=(0,a.useState)(!0),[C,R]=(0,a.useState)(!1),[P,S]=(0,a.useState)(null),[A,_]=(0,a.useState)(0),E=async()=>{try{k(!0),S(null);let e=localStorage.getItem("token");if(!e){S("Vui l\xf2ng đăng nhập để tải xuống");return}let s=await fetch(`${N.JR}/api/download/info/${v}`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||"Kh\xf4ng thể tải th\xf4ng tin tải xuống")}let r=await s.json();b(r.data)}catch(e){console.error("Error fetching download info:",e),S(e.message||"C\xf3 lỗi xảy ra khi tải dữ liệu")}finally{k(!1)}},I=async()=>{if(!w||!w.canDownload){g.oR.error("Kh\xf4ng thể tải xuống file n\xe0y");return}try{R(!0),_(0);let e=localStorage.getItem("token");if(!e){g.oR.error("Vui l\xf2ng đăng nhập để tải xuống");return}let s=await fetch(`${N.JR}/api/download/source-code/${v}`,{method:"GET",headers:{Authorization:`Bearer ${e}`}});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.message||"Kh\xf4ng thể tải xuống file")}let r=s.headers.get("content-disposition"),t=w.fileName;if(r){let e=r.match(/filename="?([^"]+)"?/);e&&(t=e[1])}let a=await s.blob(),n=window.URL.createObjectURL(a),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(n),g.oR.success("Tải xuống th\xe0nh c\xf4ng!"),setTimeout(()=>{E()},1e3)}catch(e){console.error("Error downloading file:",e),g.oR.error(e.message||"C\xf3 lỗi xảy ra khi tải xuống")}finally{R(!1),_(0)}};return(0,t.jsxs)("div",{className:"flex min-h-screen bg-gray-50",children:[(0,t.jsx)(j.DashboardSidebar,{}),(0,t.jsx)("div",{className:`flex-1 transition-all duration-300 ${e?"lg:pl-16":"lg:pl-64"}`,children:(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)(i.$,{variant:"ghost",onClick:()=>r.back(),className:"mb-4",children:[(0,t.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Quay lại"]}),(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Tải xuống Source Code"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-2",children:"Tải xuống file source code đ\xe3 mua"})]}),y?(0,t.jsxs)(d.Zp,{className:"animate-pulse",children:[(0,t.jsxs)(d.aR,{children:[(0,t.jsx)("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-2"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"})]}),(0,t.jsx)(d.Wu,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-2/3"}),(0,t.jsx)("div",{className:"h-10 bg-gray-200 rounded"})]})})]}):P?(0,t.jsx)(d.Zp,{children:(0,t.jsx)(d.Wu,{className:"text-center py-12",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"mx-auto w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:(0,t.jsx)(m.A,{className:"h-6 w-6 text-red-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Lỗi tải dữ liệu"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:P})]}),(0,t.jsx)(i.$,{onClick:E,children:"Thử lại"})]})})}):w?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(d.Zp,{children:[(0,t.jsx)(d.aR,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)(d.ZB,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.A,{className:"h-5 w-5"}),w.productName]}),(0,t.jsxs)(d.BT,{children:["M\xe3 đơn h\xe0ng: ",w.orderId]})]}),(0,t.jsx)(l.E,{variant:w.canDownload?"default":"secondary",className:"flex items-center gap-1",children:w.canDownload?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.A,{className:"h-3 w-3"})," C\xf3 thể tải xuống"]}):w.isExpired?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.A,{className:"h-3 w-3"})," Đ\xe3 hết hạn"]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.A,{className:"h-3 w-3"})," Hết lượt tải"]})})]})}),(0,t.jsxs)(d.Wu,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"T\xean file"}),(0,t.jsx)("p",{className:"font-medium",children:w.fileName})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"K\xedch thước"}),(0,t.jsx)("p",{className:"font-medium",children:w.fileSize})]}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Hết hạn"}),(0,t.jsx)("p",{className:"font-medium",children:new Date(w.expiresAt).toLocaleString("vi-VN")})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Lượt tải đ\xe3 sử dụng"}),(0,t.jsxs)("span",{children:[w.downloadCount," / ",w.maxDownloads]})]}),(0,t.jsx)(o.k,{value:w.downloadCount/w.maxDownloads*100,className:"h-2"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["C\xf2n lại ",w?Math.max(0,w.maxDownloads-w.downloadCount):0," lượt tải xuống"]})]}),C&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,t.jsx)("span",{children:"Đang tải xuống..."}),(0,t.jsxs)("span",{children:[A,"%"]})]}),(0,t.jsx)(o.k,{value:A,className:"h-2"})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.$,{onClick:I,disabled:!w.canDownload||C,className:"flex-1",children:[(0,t.jsx)(p.A,{className:"h-4 w-4 mr-2"}),C?"Đang tải xuống...":"Tải xuống"]}),(0,t.jsx)(i.$,{variant:"outline",onClick:E,disabled:C,children:"L\xe0m mới"})]})]})]}),(0,t.jsxs)(d.Zp,{children:[(0,t.jsx)(d.aR,{children:(0,t.jsx)(d.ZB,{children:"Hướng dẫn tải xuống"})}),(0,t.jsxs)(d.Wu,{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-medium mt-0.5",children:"1"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Kiểm tra th\xf4ng tin"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Đảm bảo bạn c\xf3 đủ lượt tải v\xe0 file chưa hết hạn"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-medium mt-0.5",children:"2"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Nhấn tải xuống"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"File sẽ được tải về m\xe1y t\xednh của bạn"})]})]}),(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"w-6 h-6 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-medium mt-0.5",children:"3"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:"Giải n\xe9n v\xe0 sử dụng"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Giải n\xe9n file .zip/.rar v\xe0 l\xe0m theo hướng dẫn b\xean trong"})]})]})]})]})]}):null]})})]})}},44701:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>i.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o});var t=r(65239),a=r(48088),n=r(88170),i=r.n(n),d=r(30893),l={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);r.d(s,l);let o={children:["",{children:["dashboard",{children:["download",{children:["[orderId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,78627)),"/workspaces/Store-Management/app/dashboard/download/[orderId]/page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,62998)),"/workspaces/Store-Management/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["/workspaces/Store-Management/app/dashboard/download/[orderId]/page.tsx"],m={require:r,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/dashboard/download/[orderId]/page",pathname:"/dashboard/download/[orderId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},49794:(e,s,r)=>{Promise.resolve().then(r.bind(r,39461))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78627:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>t});let t=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/workspaces/Store-Management/app/dashboard/download/[orderId]/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspaces/Store-Management/app/dashboard/download/[orderId]/page.tsx","default")}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[624,244,425],()=>r(44701));module.exports=t})();