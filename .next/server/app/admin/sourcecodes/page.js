(()=>{var e={};e.id=972,e.ids=[972],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},15616:(e,r,t)=>{"use strict";t.d(r,{T:()=>i});var a=t(60687);t(43210);var s=t(96241);function i({className:e,...r}){return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...r})}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},40640:(e,r,t)=>{Promise.resolve().then(t.bind(t,41375))},41375:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});let a=(0,t(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/workspaces/Store-Management/app/admin/sourcecodes/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/workspaces/Store-Management/app/admin/sourcecodes/page.tsx","default")},53664:(e,r,t)=>{Promise.resolve().then(t.bind(t,56766))},56766:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>S});var a=t(60687),s=t(43210),i=t(9577),n=t(55192),l=t(24934),o=t(37826),d=t(96474),c=t(41862),m=t(45126),h=t(59556),u=t(52581);let x={name:"",category:[],price:0,discountPercent:0,description:[""],policy:[""],tags:[],isActive:!0},g=()=>{let{user:e}=(0,m.A)(),[r,t]=(0,s.useState)({sourceCodes:[],categories:[],loading:!0,error:null,searchQuery:"",selectedCategory:"Tất cả",currentPage:1,totalCount:0,isCreateDialogOpen:!1,isEditDialogOpen:!1,editingSourceCode:null,isSubmitting:!1,formData:x}),a=async()=>{try{let e=await h.BP.getActive();if(e.success&&e.data){let r=Array.isArray(e.data)?e.data:e.data.data||[];t(e=>({...e,categories:r}))}}catch(e){console.error("Lỗi khi tải danh mục:",e)}},i=async()=>{try{t(e=>({...e,loading:!0}));let e=await h.d3.getAll(r.currentPage,10,r.searchQuery||void 0,"Tất cả"!==r.selectedCategory?r.selectedCategory:void 0);if(e.success&&e.data){let r=[],a=0;Array.isArray(e.data)?(r=e.data,a=e.data.length):e.data.data?(r=e.data.data,a=e.data.count||e.data.total||0):e.data.items&&(r=e.data.items,a=e.data.count||e.data.total||0),t(e=>({...e,sourceCodes:r,totalCount:a,error:null}))}else t(r=>({...r,error:e.message||"Kh\xf4ng thể tải danh s\xe1ch source code"}))}catch(e){console.error("Fetch error:",e),t(e=>({...e,error:"Lỗi kết nối đến server"}))}finally{t(e=>({...e,loading:!1}))}},n=()=>{t(e=>({...e,formData:x,editingSourceCode:null}))},l=async a=>{if(a.preventDefault(),!e){u.oR.error("Bạn cần đăng nhập để tạo source code");return}t(e=>({...e,isSubmitting:!0}));try{let a=new FormData;a.append("name",r.formData.name),r.formData.category.forEach(e=>{a.append("category",e)}),a.append("price",r.formData.price.toString()),a.append("discountPercent",(r.formData.discountPercent||0).toString()),a.append("description",r.formData.description.join(",")),a.append("policy",r.formData.policy.join(",")),a.append("tags",r.formData.tags.join(",")),a.append("isActive",r.formData.isActive.toString()),a.append("createdBy",e._id),r.formData.thumbnail&&a.append("thumbnailImage",r.formData.thumbnail),r.formData.imagePreview&&r.formData.imagePreview.length>0&&r.formData.imagePreview.forEach(e=>{a.append("imagePreview",e)}),r.formData.videoPreview&&r.formData.videoPreview.length>0&&r.formData.videoPreview.forEach(e=>{a.append("videoPreview",e)}),r.formData.videoTutorial&&r.formData.videoTutorial.length>0&&r.formData.videoTutorial.forEach(e=>{a.append("videoTutorial",e)}),r.formData.sourceCodeFile&&a.append("sourceCodeFile",r.formData.sourceCodeFile);let s=await h.d3.create(a);s.success?(u.oR.success("Tạo source code th\xe0nh c\xf4ng!"),t(e=>({...e,isCreateDialogOpen:!1})),n(),i()):u.oR.error(s.message||"Kh\xf4ng thể tạo source code")}catch(e){u.oR.error("Lỗi kết nối đến server")}finally{t(e=>({...e,isSubmitting:!1}))}},o=async a=>{if(a.preventDefault(),r.editingSourceCode){t(e=>({...e,isSubmitting:!0}));try{let a=new FormData;a.append("name",r.formData.name),r.formData.category.forEach(e=>{a.append("category",e)}),a.append("price",r.formData.price.toString()),a.append("discountPercent",(r.formData.discountPercent||0).toString()),a.append("description",r.formData.description.join(",")),a.append("policy",r.formData.policy.join(",")),a.append("tags",r.formData.tags.join(",")),a.append("isActive",r.formData.isActive.toString()),e?._id&&a.append("createdBy",e._id),r.formData.thumbnail&&a.append("thumbnailImage",r.formData.thumbnail),r.formData.imagePreview&&r.formData.imagePreview.length>0&&r.formData.imagePreview.forEach(e=>{a.append("imagePreview",e)}),r.formData.videoPreview&&r.formData.videoPreview.length>0&&r.formData.videoPreview.forEach(e=>{a.append("videoPreview",e)}),r.formData.videoTutorial&&r.formData.videoTutorial.length>0&&r.formData.videoTutorial.forEach(e=>{a.append("videoTutorial",e)}),r.formData.sourceCodeFile&&a.append("sourceCodeFile",r.formData.sourceCodeFile);let s=await h.d3.update(r.editingSourceCode._id,a);s.success?(u.oR.success("Cập nhật source code th\xe0nh c\xf4ng!"),t(e=>({...e,isEditDialogOpen:!1})),n(),i()):u.oR.error(s.message||"Kh\xf4ng thể cập nhật source code")}catch(e){u.oR.error("Lỗi kết nối đến server")}finally{t(e=>({...e,isSubmitting:!1}))}}},d=async e=>{try{let r=await h.d3.delete(e);r.success?(u.oR.success("X\xf3a source code th\xe0nh c\xf4ng!"),i()):u.oR.error(r.message||"Kh\xf4ng thể x\xf3a source code")}catch(e){u.oR.error("Lỗi kết nối đến server")}},c=r.sourceCodes?.filter(e=>{let t=e.name.toLowerCase().includes(r.searchQuery.toLowerCase()),a=(()=>{if("Tất cả"===r.selectedCategory)return!0;let t=e.category;return!!t&&(Array.isArray(t)?0!==t.length&&("string"==typeof t[0]?t.includes(r.selectedCategory):t.some(e=>(e?._id||e?.id)===r.selectedCategory)):"string"==typeof t?t===r.selectedCategory:(t?._id||t?.id)===r.selectedCategory)})();return t&&a})||[];return(0,s.useEffect)(()=>{a(),i()},[r.currentPage]),(0,s.useEffect)(()=>{a()},[]),{...r,filteredSourceCodes:c,itemsPerPage:10,setSourceCodes:e=>t(r=>({...r,sourceCodes:e})),setCategories:e=>t(r=>({...r,categories:e})),setLoading:e=>t(r=>({...r,loading:e})),setError:e=>t(r=>({...r,error:e})),setSearchQuery:e=>t(r=>({...r,searchQuery:e})),setSelectedCategory:e=>t(r=>({...r,selectedCategory:e})),setCurrentPage:e=>t(r=>({...r,currentPage:e})),setTotalCount:e=>t(r=>({...r,totalCount:e})),setIsCreateDialogOpen:e=>t(r=>({...r,isCreateDialogOpen:e})),setIsEditDialogOpen:e=>t(r=>({...r,isEditDialogOpen:e})),setEditingSourceCode:e=>t(r=>({...r,editingSourceCode:e})),setIsSubmitting:e=>t(r=>({...r,isSubmitting:e})),setFormData:e=>{t(r=>({...r,formData:"function"==typeof e?e(r.formData):e}))},resetForm:n,fetchCategories:a,fetchSourceCodes:i,handleCreateSourceCode:l,handleEditSourceCode:o,handleDeleteSourceCode:d,openEditDialog:e=>{t(r=>({...r,editingSourceCode:e,formData:{name:e.name,category:Array.isArray(e.category)?e.category.map(e=>"string"==typeof e?e:e?._id):[],price:e.price,discountPercent:e.discountPercent||0,description:e.description||[""],policy:e.policy||[""],tags:e.tags||[],isActive:e.isActive??!0},isEditDialogOpen:!0}))},handleFileChange:(e,r)=>{r&&("thumbnail"===e||"sourceCodeFile"===e?t(t=>({...t,formData:{...t.formData,[e]:r[0]}})):("imagePreview"===e||"videoPreview"===e||"videoTutorial"===e)&&t(t=>({...t,formData:{...t.formData,[e]:Array.from(r)}})))},handleArrayFieldChange:(e,r,a)=>{t(t=>({...t,formData:{...t.formData,[e]:t.formData[e].map((e,t)=>t===r?a:e)}}))},addArrayField:e=>{t(r=>({...r,formData:{...r.formData,[e]:[...r.formData[e],""]}}))},removeArrayField:(e,r)=>{t(t=>({...t,formData:{...t.formData,[e]:t.formData[e].filter((e,t)=>t!==r)}}))},handleTagsChange:e=>{let r=e.split(",").map(e=>e.trim()).filter(e=>e.length>0);t(e=>({...e,formData:{...e.formData,tags:r}}))},getCategoryName:e=>{let t=r.categories.find(r=>r._id===e);return t?t.name:e}}};var p=t(68988),v=t(39390),f=t(15616),j=t(63974),b=t(59821),y=t(88233);let N=process.env.NEXT_PUBLIC_API_URL||"http://localhost:5000",w=({formData:e,setFormData:r,categories:t,isSubmitting:s,isEdit:i=!1,editingSourceCode:n,onSubmit:o,handleFileChange:m,handleArrayFieldChange:h,addArrayField:u,removeArrayField:x,handleTagsChange:g})=>(0,a.jsxs)("form",{onSubmit:o,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"sourcecode-name",children:"T\xean source code *"}),(0,a.jsx)(p.p,{id:"sourcecode-name",value:e.name,onChange:e=>r(r=>({...r,name:e.target.value})),required:!0,placeholder:"Nhập t\xean source code"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"sourcecode-category",children:"Danh mục *"}),(0,a.jsxs)(j.Select,{onValueChange:t=>{e.category.includes(t)||r(e=>({...e,category:[...e.category,t]}))},children:[(0,a.jsx)(j.SelectTrigger,{children:(0,a.jsx)(j.SelectValue,{placeholder:"Chọn danh mục để th\xeam"})}),(0,a.jsx)(j.SelectContent,{children:t.filter(r=>!e.category.includes(r._id)).map(e=>(0,a.jsx)(j.SelectItem,{value:e._id,children:e.name},e._id))})]}),e.category.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.category.map(e=>{let s=t.find(r=>r._id===e);return(0,a.jsxs)(b.E,{variant:"secondary",className:"flex items-center gap-1",children:[s?.name||e,(0,a.jsx)("button",{type:"button",onClick:()=>r(r=>({...r,category:r.category.filter(r=>r!==e)})),className:"ml-1 text-xs hover:text-red-500",children:"\xd7"})]},e)})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"sourcecode-price",children:"Gi\xe1 b\xe1n *"}),(0,a.jsx)(p.p,{id:"sourcecode-price",type:"number",min:"0",step:"1000",value:e.price||"",onChange:e=>{let t=e.target.value;(""===t||!isNaN(Number(t))&&Number(t)>=0)&&r(e=>({...e,price:""===t?0:Number(t)}))},required:!0,placeholder:"Nhập gi\xe1 b\xe1n"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"sourcecode-discount",children:"Giảm gi\xe1 (%)"}),(0,a.jsx)(p.p,{id:"sourcecode-discount",type:"number",min:"0",max:"100",step:"1",value:e.discountPercent||"",onChange:e=>{let t=e.target.value;(""===t||!isNaN(Number(t))&&Number(t)>=0&&100>=Number(t))&&r(e=>({...e,discountPercent:""===t?void 0:Number(t)}))},placeholder:"Nhập % giảm gi\xe1"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"sourcecode-tags",children:"Tags"}),(0,a.jsx)(p.p,{id:"sourcecode-tags",value:e.tags.join(", "),onChange:e=>g(e.target.value),placeholder:"Nhập tags, ph\xe2n c\xe1ch bằng dấu phẩy"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"V\xed dụ: React, JavaScript, Frontend"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"sourcecode-active",checked:e.isActive,onChange:e=>r(r=>({...r,isActive:e.target.checked})),className:"rounded border-gray-300"}),(0,a.jsx)(v.J,{htmlFor:"sourcecode-active",children:"K\xedch hoạt"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{children:"M\xf4 tả"}),e.description.map((r,t)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(f.T,{value:r,onChange:e=>h("description",t,e.target.value),placeholder:"Nhập m\xf4 tả..."}),e.description.length>1&&(0,a.jsx)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>x("description",t),children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]},t)),(0,a.jsxs)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>u("description"),children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"})," Th\xeam m\xf4 tả"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{children:"Ch\xednh s\xe1ch"}),e.policy.map((r,t)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(f.T,{value:r,onChange:e=>h("policy",t,e.target.value),placeholder:"Nhập ch\xednh s\xe1ch..."}),e.policy.length>1&&(0,a.jsx)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>x("policy",t),children:(0,a.jsx)(y.A,{className:"h-4 w-4"})})]},t)),(0,a.jsxs)(l.$,{type:"button",variant:"outline",size:"sm",onClick:()=>u("policy"),children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"})," Th\xeam ch\xednh s\xe1ch"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"thumbnail",className:"text-sm font-medium",children:"Ảnh thumbnail"}),i&&n?.thumbnailImage&&!e.thumbnail&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-gray-50",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Ảnh hiện tại:"}),(0,a.jsx)("img",{src:`${N}/api/files/${n.thumbnailImage}`,alt:"Current thumbnail",className:"w-20 h-20 object-cover rounded border",onError:e=>{e.currentTarget.style.display="none"}})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.p,{id:"thumbnail",type:"file",accept:"image/*",onChange:e=>m("thumbnail",e.target.files),className:"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:i?"Chọn ảnh mới để thay thế":"Chọn ảnh đại diện"})]}),e.thumbnail&&(0,a.jsx)("div",{className:"mt-2 p-2 border rounded-md bg-blue-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-blue-700 truncate",children:e.thumbnail.name}),(0,a.jsx)(l.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>r(e=>({...e,thumbnail:void 0})),className:"text-red-600 hover:text-red-800 h-6 w-6 p-0",children:"\xd7"})]})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"sourceCodeFile",className:"text-sm font-medium",children:"File source code *"}),i&&n?.sourceCodeFile&&!e.sourceCodeFile&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-gray-50",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"File hiện tại:"}),(0,a.jsx)("div",{className:"text-sm font-medium text-blue-600",children:n.sourceCodeFile})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.p,{id:"sourceCodeFile",type:"file",accept:".zip,.rar,.7z,.tar.gz",onChange:e=>m("sourceCodeFile",e.target.files),className:"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100",required:!i}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:i?"Chọn file mới để thay thế":"Chọn file source code (ZIP, RAR, 7Z)"})]}),e.sourceCodeFile&&(0,a.jsx)("div",{className:"mt-2 p-2 border rounded-md bg-green-50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-green-700 truncate",children:e.sourceCodeFile.name}),(0,a.jsx)(l.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>r(e=>({...e,sourceCodeFile:void 0})),className:"text-red-600 hover:text-red-800 h-6 w-6 p-0",children:"\xd7"})]})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"imagePreview",className:"text-sm font-medium",children:"Ảnh preview"}),i&&n?.imagePreview&&n.imagePreview.length>0&&(!e.imagePreview||0===e.imagePreview.length)&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-gray-50",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Ảnh hiện tại:"}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-2",children:n.imagePreview.map((e,r)=>(0,a.jsx)("img",{src:`${N}/api/files/${e}`,alt:`Preview ${r+1}`,className:"w-20 h-20 object-cover rounded border",onError:e=>{e.currentTarget.style.display="none"}},r))})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.p,{id:"imagePreview",type:"file",accept:"image/*",multiple:!0,onChange:e=>m("imagePreview",e.target.files),className:"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-purple-50 file:text-purple-700 hover:file:bg-purple-100"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Chọn nhiều ảnh để preview sản phẩm"})]}),e.imagePreview&&e.imagePreview.length>0&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-purple-50",children:[(0,a.jsxs)("div",{className:"text-sm text-purple-700 mb-2",children:["Đ\xe3 chọn ",e.imagePreview.length," ảnh:"]}),(0,a.jsx)("div",{className:"space-y-1",children:Array.from(e.imagePreview).map((e,r)=>(0,a.jsx)("div",{className:"text-xs text-purple-600 truncate",children:e.name},r))}),(0,a.jsx)(l.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>r(e=>({...e,imagePreview:void 0})),className:"text-red-600 hover:text-red-800 mt-2",children:"X\xf3a tất cả"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"videoPreview",className:"text-sm font-medium",children:"Video preview"}),i&&n?.videoPreview&&n.videoPreview.length>0&&(!e.videoPreview||0===e.videoPreview.length)&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-gray-50",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Video preview hiện tại:"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:n.videoPreview.map((e,r)=>(0,a.jsx)("video",{src:`${N}/api/files/${e}`,controls:!0,className:"w-full h-40 rounded border bg-black",onError:e=>{e.currentTarget.style.display="none"}},r))})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.p,{id:"videoPreview",type:"file",accept:"video/*",multiple:!0,onChange:e=>m("videoPreview",e.target.files),className:"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Chọn video để preview sản phẩm"})]}),e.videoPreview&&e.videoPreview.length>0&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-orange-50",children:[(0,a.jsxs)("div",{className:"text-sm text-orange-700 mb-2",children:["Đ\xe3 chọn ",e.videoPreview.length," video:"]}),(0,a.jsx)("div",{className:"space-y-1",children:Array.from(e.videoPreview).map((e,r)=>(0,a.jsx)("div",{className:"text-xs text-orange-600 truncate",children:e.name},r))}),(0,a.jsx)(l.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>r(e=>({...e,videoPreview:void 0})),className:"text-red-600 hover:text-red-800 mt-2",children:"X\xf3a tất cả"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(v.J,{htmlFor:"videoTutorial",className:"text-sm font-medium",children:"Video hướng dẫn"}),i&&n?.videoTutorial&&n.videoTutorial.length>0&&(!e.videoTutorial||0===e.videoTutorial.length)&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-gray-50",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2",children:"Video hướng dẫn hiện tại:"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:n.videoTutorial.map((e,r)=>(0,a.jsx)("video",{src:`${N}/api/files/${e}`,controls:!0,className:"w-full h-40 rounded border bg-black",onError:e=>{e.currentTarget.style.display="none"}},r))})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(p.p,{id:"videoTutorial",type:"file",accept:"video/*",multiple:!0,onChange:e=>m("videoTutorial",e.target.files),className:"file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-teal-50 file:text-teal-700 hover:file:bg-teal-100"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Chọn video hướng dẫn sử dụng"})]}),e.videoTutorial&&e.videoTutorial.length>0&&(0,a.jsxs)("div",{className:"mt-2 p-2 border rounded-md bg-teal-50",children:[(0,a.jsxs)("div",{className:"text-sm text-teal-700 mb-2",children:["Đ\xe3 chọn ",e.videoTutorial.length," video:"]}),(0,a.jsx)("div",{className:"space-y-1",children:Array.from(e.videoTutorial).map((e,r)=>(0,a.jsx)("div",{className:"text-xs text-teal-600 truncate",children:e.name},r))}),(0,a.jsx)(l.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>r(e=>({...e,videoTutorial:void 0})),className:"text-red-600 hover:text-red-800 mt-2",children:"X\xf3a tất cả"})]})]}),(0,a.jsx)("div",{className:"flex justify-end space-x-2 pt-4",children:(0,a.jsxs)(l.$,{type:"submit",disabled:s,children:[s&&(0,a.jsx)(c.A,{className:"mr-2 h-4 w-4 animate-spin"}),i?"Cập nhật":"Tạo mới"]})})]});var C=t(95033),D=t(13861),P=t(63143);let A=({sourceCodes:e,categories:r,loading:t,onEdit:s,onDelete:i,getCategoryName:o})=>t?(0,a.jsx)(n.Zp,{children:(0,a.jsxs)(n.Wu,{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(c.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:"Đang tải..."})]})}):0===e.length?(0,a.jsx)(n.Zp,{children:(0,a.jsx)(n.Wu,{className:"flex items-center justify-center py-8",children:(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Kh\xf4ng c\xf3 source code n\xe0o"})})})}):(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:e.map(e=>(0,a.jsxs)(n.Zp,{className:"group hover:shadow-xl transition-all duration-300 border border-gray-200 shadow-sm hover:scale-[1.03] hover:border-blue-300 bg-white overflow-hidden",children:[(0,a.jsxs)(n.aR,{className:"pb-3 px-4 pt-4",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-2",children:(0,a.jsx)(b.E,{variant:e.isActive?"default":"secondary",className:e.isActive?"bg-emerald-500 text-white border-0 shadow-sm":"bg-gray-400 text-white border-0",children:e.isActive?"Hoạt động":"Tạm dừng"})}),(0,a.jsx)(n.ZB,{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors line-clamp-2 leading-tight",children:e.name}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1.5 mt-2",children:[e.category?.slice(0,2).map((e,r)=>{let t="string"==typeof e?e:e._id,s="string"==typeof e?o(e):e.name;return a.jsx(b.E,{variant:"outline",className:"text-xs border-blue-200 text-blue-600 bg-blue-50 hover:bg-blue-100",children:s},`${t}-${r}`)}),e.category&&e.category.length>2&&(0,a.jsxs)(b.E,{variant:"outline",className:"text-xs border-gray-300 text-gray-500 bg-gray-50",children:["+",e.category.length-2]})]})]}),(0,a.jsxs)(n.Wu,{className:"px-4 pb-4 space-y-3",children:[(0,a.jsxs)("div",{className:"relative",children:[e.thumbnailImage?(0,a.jsx)("div",{className:"w-full h-40 bg-gray-100 rounded-md overflow-hidden",children:(0,a.jsx)("img",{src:`http://localhost:5000/api/files/${e.thumbnailImage}`,alt:"Thumbnail",className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500",onError:e=>{e.currentTarget.src="/placeholder-image.png"}})}):(0,a.jsx)("div",{className:"w-full h-40 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-md flex items-center justify-center border border-blue-200",children:(0,a.jsxs)("div",{className:"text-center text-blue-400",children:[(0,a.jsx)(D.A,{className:"h-6 w-6 mx-auto mb-1"}),(0,a.jsx)("p",{className:"text-xs font-medium",children:"Kh\xf4ng c\xf3 ảnh"})]})}),(0,a.jsxs)("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:[e.imagePreview&&e.imagePreview.length>0&&(0,a.jsxs)(b.E,{variant:"secondary",className:"text-xs bg-black/70 text-white border-0 backdrop-blur-sm",children:["\uD83D\uDCF7 ",e.imagePreview.length]}),e.videoPreview&&e.videoPreview.length>0&&(0,a.jsxs)(b.E,{variant:"secondary",className:"text-xs bg-black/70 text-white border-0 backdrop-blur-sm",children:["\uD83C\uDFA5 ",e.videoPreview.length]}),e.sourceCodeFile&&(0,a.jsx)(b.E,{variant:"secondary",className:"text-xs bg-black/70 text-white border-0 backdrop-blur-sm",children:"\uD83D\uDCC1 Code"})]})]}),(0,a.jsx)("div",{className:"bg-gradient-to-r from-emerald-50 to-green-50 p-3 rounded-md border border-emerald-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-medium text-emerald-700 mb-1",children:"Gi\xe1 b\xe1n"}),(0,a.jsxs)("p",{className:"text-lg font-bold text-emerald-600",children:[e.price?.toLocaleString("vi-VN")," VNĐ"]})]}),e.discountPercent&&e.discountPercent>0&&(0,a.jsxs)(b.E,{className:"bg-red-500 text-white text-xs px-2 py-1",children:["-",e.discountPercent,"%"]})]})}),e.tags&&e.tags.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-600 mb-1.5",children:"Tags"}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-1",children:[e.tags.slice(0,3).map((e,r)=>(0,a.jsx)(b.E,{variant:"outline",className:"text-xs border-purple-200 text-purple-600 bg-purple-50 hover:bg-purple-100",children:e},r)),e.tags.length>3&&(0,a.jsxs)(b.E,{variant:"outline",className:"text-xs border-gray-300 text-gray-500 bg-gray-50",children:["+",e.tags.length-3]})]})]}),e.description&&e.description.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-600 mb-1",children:"M\xf4 tả"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 line-clamp-2 leading-relaxed",children:e.description[0]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-gray-500 border-t pt-2",children:[(0,a.jsxs)("span",{children:["\uD83D\uDC41️ ",e.viewCount||0]}),(0,a.jsxs)("span",{children:["⬇️ ",e.downloadCount||0]}),(0,a.jsx)("span",{children:e.createdAt?new Date(e.createdAt).toLocaleDateString("vi-VN"):"N/A"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-1",children:[(0,a.jsxs)(l.$,{variant:"outline",size:"sm",onClick:()=>s(e),className:"flex-1 h-8 text-xs hover:bg-blue-50 hover:text-blue-600 hover:border-blue-300 transition-colors",children:[(0,a.jsx)(P.A,{className:"h-3 w-3 mr-1"}),"Sửa"]}),(0,a.jsxs)(C.Lt,{children:[(0,a.jsx)(C.tv,{asChild:!0,children:(0,a.jsx)(l.$,{variant:"outline",size:"sm",className:"h-8 px-2 hover:bg-red-50 hover:text-red-600 hover:border-red-300 transition-colors",children:(0,a.jsx)(y.A,{className:"h-3 w-3"})})}),(0,a.jsxs)(C.EO,{children:[(0,a.jsxs)(C.wd,{children:[(0,a.jsx)(C.r7,{children:"X\xe1c nhận x\xf3a"}),(0,a.jsxs)(C.$v,{children:['Bạn c\xf3 chắc chắn muốn x\xf3a source code "',e.name,'"? H\xe0nh động n\xe0y kh\xf4ng thể ho\xe0n t\xe1c.']})]}),(0,a.jsxs)(C.ck,{children:[(0,a.jsx)(C.Zr,{children:"Hủy"}),(0,a.jsx)(C.Rx,{onClick:()=>i(e._id),className:"bg-red-600 hover:bg-red-700",children:"X\xf3a"})]})]})]})]})]})]},e._id))})});var T=t(99270);let F=({searchQuery:e,selectedCategory:r,categories:t,onSearchChange:s,onCategoryChange:i})=>(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(T.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),(0,a.jsx)(p.p,{placeholder:"T\xecm kiếm source code...",value:e,onChange:e=>s(e.target.value),className:"pl-10"})]}),(0,a.jsx)("div",{className:"w-full sm:w-64",children:(0,a.jsxs)(j.Select,{value:r,onValueChange:i,children:[(0,a.jsx)(j.SelectTrigger,{children:(0,a.jsx)(j.SelectValue,{placeholder:"Chọn danh mục"})}),(0,a.jsxs)(j.SelectContent,{children:[(0,a.jsx)(j.SelectItem,{value:"Tất cả",children:"Tất cả danh mục"}),t.map(e=>(0,a.jsx)(j.SelectItem,{value:e._id,children:e.name},e._id))]})]})})]});function S(){let{user:e}=(0,m.A)(),{sourceCodes:r,categories:t,loading:s,error:h,searchQuery:u,selectedCategory:x,currentPage:p,totalCount:v,isCreateDialogOpen:f,isEditDialogOpen:j,editingSourceCode:b,isSubmitting:y,formData:N,setSearchQuery:C,setSelectedCategory:D,setCurrentPage:P,setIsCreateDialogOpen:T,setIsEditDialogOpen:S,handleCreateSourceCode:k,handleEditSourceCode:E,handleDeleteSourceCode:_,resetForm:$,setFormData:R,handleFileChange:z,handleArrayFieldChange:L,addArrayField:M,removeArrayField:I,handleTagsChange:J,openEditDialog:V}=g(),q=r?.filter(e=>{let r=e.name.toLowerCase().includes(u.toLowerCase()),t="Tất cả"===x||e.category&&e.category.includes(x);return r&&t})||[],O=async e=>{await k(e)},B=async e=>{await E(e)};return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.DashboardSidebar,{}),(0,a.jsx)("div",{className:"flex-1 overflow-auto lg:pl-64",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)(n.Zp,{children:[(0,a.jsx)(n.aR,{children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(n.ZB,{children:"Quản l\xfd Source Code"}),(0,a.jsx)("p",{className:"text-muted-foreground mt-2",children:"Quản l\xfd danh s\xe1ch source code v\xe0 th\xf4ng tin chi tiết"})]}),(0,a.jsxs)(o.lG,{open:f,onOpenChange:T,children:[(0,a.jsx)(o.zM,{asChild:!0,children:(0,a.jsxs)(l.$,{onClick:$,children:[(0,a.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Th\xeam source code"]})}),(0,a.jsxs)(o.Cf,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(o.c7,{children:(0,a.jsx)(o.L3,{children:"Th\xeam source code mới"})}),(0,a.jsx)(w,{formData:N,setFormData:R,categories:t,isSubmitting:y,onSubmit:O,handleFileChange:z,handleArrayFieldChange:L,addArrayField:M,removeArrayField:I,handleTagsChange:J})]})]})]})}),(0,a.jsxs)(n.Wu,{children:[h&&(0,a.jsx)("div",{className:"bg-destructive/15 text-destructive px-4 py-3 rounded-md mb-6",children:h}),(0,a.jsx)(F,{searchQuery:u,selectedCategory:x,categories:t,onSearchChange:C,onCategoryChange:D}),s?(0,a.jsxs)("div",{className:"flex justify-center items-center py-12",children:[(0,a.jsx)(c.A,{className:"h-8 w-8 animate-spin"}),(0,a.jsx)("span",{className:"ml-2",children:"Đang tải..."})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(A,{sourceCodes:q,categories:t,loading:s,onEdit:V,onDelete:_,getCategoryName:e=>{let r=t.find(r=>r._id===e);return r?r.name:e}}),v>10&&(0,a.jsxs)("div",{className:"flex justify-center gap-2 mt-8",children:[(0,a.jsx)(l.$,{variant:"outline",onClick:()=>P(Math.max(1,p-1)),disabled:1===p,children:"Trang trước"}),(0,a.jsxs)("span",{className:"flex items-center px-4 text-sm text-muted-foreground",children:["Trang ",p," / ",Math.ceil(v/10)]}),(0,a.jsx)(l.$,{variant:"outline",onClick:()=>P(p+1),disabled:p>=Math.ceil(v/10),children:"Trang sau"})]})]})]})]}),(0,a.jsx)(o.lG,{open:j,onOpenChange:S,children:(0,a.jsxs)(o.Cf,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsx)(o.c7,{children:(0,a.jsx)(o.L3,{children:"Chỉnh sửa source code"})}),(0,a.jsx)(w,{formData:N,setFormData:R,categories:t,isSubmitting:y,onSubmit:B,handleFileChange:z,handleArrayFieldChange:L,addArrayField:M,removeArrayField:I,handleTagsChange:J,isEdit:!0,editingSourceCode:b})]})})]})})]}):(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Truy cập bị từ chối"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Bạn cần đăng nhập để truy cập trang n\xe0y."})]})})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71161:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>d});var a=t(65239),s=t(48088),i=t(88170),n=t.n(i),l=t(30893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);t.d(r,o);let d={children:["",{children:["admin",{children:["sourcecodes",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,41375)),"/workspaces/Store-Management/app/admin/sourcecodes/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,97786)),"/workspaces/Store-Management/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,62998)),"/workspaces/Store-Management/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,65284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,c=["/workspaces/Store-Management/app/admin/sourcecodes/page.tsx"],m={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/admin/sourcecodes/page",pathname:"/admin/sourcecodes",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},96474:(e,r,t)=>{"use strict";t.d(r,{A:()=>a});let a=(0,t(62688).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[624,182,248,244,987],()=>t(71161));module.exports=a})();